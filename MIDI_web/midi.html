<!DOCTYPE html>
<meta charset="utf-8"> 
<html>
<head></head>

<style>
*{
    margin:0;
    padding:0;
}
</style>

<textarea id="sheet_music"></textarea>
<button id="p">播放</button>


<script>
//https://stackoverflow.com/questions/7686197/how-can-i-avoid-autorepeated-keydown-events-in-javascript
//var keyAllowed = {};

var audio_element = [];
var sharp_music = "cdfga";
var music_order=[];
var music_file_name = [];
var str;
var index=0;

music_order.push("1");
music_order.push("c");
music_order.push("2");
music_order.push("d");
music_order.push("3");
music_order.push("4");
music_order.push("f");
music_order.push("5");
music_order.push("g");
music_order.push("6");
music_order.push("a");
music_order.push("7");

for(var i=0;i<music_order.length;i++)
{
	music_file_name.push(music_order[i]+"b");
}

for(var i=0;i<music_order.length;i++)
{
	music_file_name.push(music_order[i]);
}

for(var i=0;i<music_order.length;i++)
{
	music_file_name.push(music_order[i]+"s");
}

for(var i=0;i<music_file_name.length;i++)
{
	audio_element[i] = new Audio(music_file_name[i]+".mp3");
	audio_element[i].id=music_file_name[i];
	document.documentElement.appendChild(audio_element[i]);
}

function suddenly(){
	document.getElementById(str[index-2]).pause();
	document.getElementById(str[index-2]).currentTime=0;
	
	play_music();
}

function cont(){
	if(str[index])
	{
		document.getElementById(str[index]).play();
	}
}

p.addEventListener("click",parse_sheet);

function parse_sheet(){
  str = sheet_music.value.split(" ");
  play_music(0)
}

function play_music(){
 if(str[index])
 {
	document.getElementById(str[index++]).play();
	setTimeout(suddenly,str[index]);
	setTimeout(cont,str[index++]-100);
 }
 else
 {
	index=0;
 }
}

/*document.onkeydown=function(e){
  console.log(e.keyCode);

  if (keyAllowed [e.which] === false) return;
  keyAllowed [e.which] = false;

  switch(e.keyCode)
  {
    case 65:
      music_C.play();
      break;
    case 83:
      music_D.play();
      break;
    case 68:
      music_E.play();
      break;
    case 70:
      music_F.play();
      break;
    case 71:
      music_G.play();
      break;
    case 72:
      music_A.play();
      break;
    case 74:
      music_B.play();
      break;
    case 75:
      music_C_sharp.play();
      break;
    case 76:
      music_D_sharp.play();
      break;
    case 59:
    case 186:
      music_E_sharp.play();
      break;
    case 222:
      music_F_sharp.play();
      break;
    case 90:
      music_G_sharp.play();
      break;
    case 88:
      music_A_sharp.play();
      break;
    case 67:
      music_B_sharp.play();
      break;
  }
}

document.onkeyup=function(e){

  keyAllowed [e.which] = true;

  switch(e.keyCode)
  {
    case 65:
      music_C.pause();
      music_C.currentTime=0;
      break;
    case 83:
      music_D.pause();
      break;
    case 68:
      music_E.pause();
      break;
    case 70:
      music_F.pause();
      break;
    case 71:
      music_G.pause();
      break;
    case 72:
      music_A.pause();
      break;
    case 74:
      music_B.pause();
      break;
    case 75:
      music_C_sharp.pause();
      break;
    case 76:
      music_D_sharp.pause();
      break;
    case 59:
    case 186:
      music_E_sharp.pause();
      break;
    case 222:
      music_F_sharp.pause();
      break;
    case 90:
      music_G_sharp.pause();
      break;
    case 88:
      music_A_sharp.pause();
      break;
    case 67:
      music_B_sharp.pause();
      break;
  }
}*/

</script>

<body>
</body>
</html>
