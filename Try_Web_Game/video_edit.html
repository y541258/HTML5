<!DOCTYPE>
<meta charset="utf-8"> 
<html>
<head>
</head>
<body>
<script src="jquery-3.3.1.js"></script>
<video id="v" width="320" height="240" controls autoplay></video> 
<div id="div_test"></div>

<input type="file"></input>
<button id="save_file">存檔</button>

<script>
var dv;
var f;
const input = document.querySelector('input')
input.addEventListener('change', handleFiles, false);
function handleFiles (files) { // files -> FileList 物件，裡面有 File 實例
//	document.getElementById("v").src = window.URL.createObjectURL(result);
	//document.getElementById("v").src = window.URL.createObjectURL(files.target.files[0]);
  if (files.target.files[0]) {
    const reader = new FileReader();
	const reader1 = new FileReader();
    reader.onload = function (data) {
	console.log(data.target.result);
	dv = new DataView(data.target.result,0,4444444);
	//抓取影片檔(其實也要使用者是上傳影片檔)的前4444444 bytes
	f = new Blob([dv],{type:'video/mp4'});
		document.getElementById("v").src = window.URL.createObjectURL(f);
		setInterval(test,5000);
    }
	
    reader.readAsArrayBuffer(files.target.files[0]);
  }
}


//https://stackoverflow.com/questions/19175174/capture-frames-from-video-with-html5-and-javascript
function test(){
var c = document.createElement("canvas");
var ctx = c.getContext("2d");
c.width = 160;
c.height = 90;
ctx.drawImage(v, 0, 0, 160, 90);
div_test.appendChild(c);
}

save_file.addEventListener("click",download);

function download() {
	var download_link = document.createElement('a');
	var url = window.URL.createObjectURL(f);
	download_link.href= url;
    download_link.setAttribute('download', "cut.mp4");
	
    if (document.createEvent) {
        var event = document.createEvent('MouseEvents');
        event.initEvent('click', true, true);
        download_link.dispatchEvent(event);
    }
    else {
        download_link.click();
    }
}
</script>

</body>
</html> 